(function(i){i.fn.rssfeed=function(n,b,u){b=i.extend({limit:10,offset:1,header:!0,titletag:"h4",date:!0,content:!0,snippet:!0,media:!0,showerror:!0,errormsg:"",key:null,ssl:!1,linktarget:"_self",linkredirect:"",linkcontent:!1,sort:"",sortasc:!0,historical:!1},b);return this.each(function(v,o){var s=i(o),d="";b.ssl&&(d="s");s.hasClass("rssFeed")||s.addClass("rssFeed");if(null==n)return!1;0<b.offset&&(b.offset-=1);b.limit+=b.offset;d="http"+d+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+
encodeURIComponent(n);d+="&num="+b.limit;b.historical&&(d+="&scoring=h");null!=b.key&&(d+="&key="+b.key);i.getJSON(d+"&output=json_xml",function(g){if(g.responseStatus==200){var d=g.responseData,e=b;if(g=d.feed){var f=[],c=0,j="",t="odd";if(e.media){var m=d.xmlString;if(navigator.appName=="Microsoft Internet Explorer"){c=new ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(m)}else c=(new DOMParser).parseFromString(m,"text/xml");m=c.getElementsByTagName("item")}e.header&&(j=j);j=j+'<div class="rssBody"><ul>';for(d=e.offset;d<g.entries.length;d++){c=d-e.offset;f[c]=[];var a=g.entries[d],k,l="",h=a.link;switch(e.sort){case "title":l=a.title;break;case "date":l=a.publishedDate}f[c].sort=l;if(a.publishedDate){k=new Date(a.publishedDate);k=k.toLocaleDateString()+" "+k.toLocaleTimeString()}e.linkredirect&&(h=encodeURIComponent(h));f[c].html="<"+e.titletag+'><a href="'+e.linkredirect+h+'" title="View this feed at '+
g.title+'" target="_blank" onclick="window.open(this.href);return false;">'+a.title+"</a></"+e.titletag+">";e.date&&k&&(f[c].html=f[c].html+("<div>"+k+"</div>"));if(e.content){a=e.snippet&&a.contentSnippet!=""?a.contentSnippet:a.content;e.linkcontent&&(a='<a href="'+e.linkredirect+h+'" title="View this feed at '+g.title+'">'+a+"</a>");f[c].html=f[c].html+("<p>"+a+"</p>")}if(e.media&&m.length>0){h=m[d].getElementsByTagName("enclosure");if(h.length>0){f[c].html=f[c].html+'<div class="rssMedia"><div>Media files</div><ul>';for(a=0;a<h.length;a++){var p=h[a].getAttribute("url"),
q=h[a].getAttribute("type"),r=h[a].getAttribute("length"),l=f[c],n=l.html,p='<li><a href="'+p+'" title="Download this media">'+p.split("/").pop()+"</a> ("+q+", ",q=Math.floor(Math.log(r)/Math.log(1024)),r=(r/Math.pow(1024,Math.floor(q))).toFixed(2)+" "+["bytes","kb","MB","GB","TB","PB"][q];l.html=n+(p+r+")</li>")}f[c].html=f[c].html+"</ul></div>"}}}e.sort&&f.sort(function(c,d){if(e.sortasc)var a=c.sort,b=d.sort;else{a=d.sort;b=c.sort}if(e.sort=="date")return new Date(a)-new Date(b);a=a.toLowerCase();
b=b.toLowerCase();return a<b?-1:a>b?1:0});i.each(f,function(a){j=j+('<li class="rssRow '+t+'">'+f[a].html+"</li>");t=t=="odd"?"even":"odd"});j=j+"</ul></div>";i(o).html(j);i("a",o).attr("target",e.linktarget)}i.isFunction(u)&&u.call(this,s)}else{b.showerror&&(c=b.errormsg!=""?b.errormsg:g.responseDetails);i(o).html('<div class="rssError"><p>'+c+"</p></div>")}})})}})(jQuery);